        
                // Update UI
                renderTradeLog();
                calculateStats();
                
                // Show success message
                alert('Trade saved successfully!');
                
                // Clear form
                clearForm();
            }
            
            // Clear the form fields
            function clearForm() {
                tradeDateInput.valueAsDate = new Date();
                tradePairInput.value = 'SOL';
                tradeDirectionInput.value = 'LONG';
                tradeResultInput.value = 'Win';
                pnlInput.value = '';
                leverageInput.value = '30';
                strategyInput.value = 'DCA';
                tradeNotesInput.value = '';
            }
            
            // Delete a trade
            function deleteTrade(index) {
                if (confirm('Are you sure you want to delete this trade?')) {
                    trades.splice(index, 1);
                    localStorage.setItem('trades', JSON.stringify(trades));
                    renderTradeLog();
                    calculateStats();
                }
            }
            
            // Export trades to JSON file
            function exportTrades() {
                if (trades.length === 0) {
                    alert('No trades to export');
                    return;
                }
                
                const dataStr = JSON.stringify(trades, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileName = `crypto_trades_${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileName);
                linkElement.click();
            }
            
            // Import trades from JSON file
            function importTrades(file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedTrades = JSON.parse(e.target.result);
                        
                        if (Array.isArray(importedTrades)) {
                            // Add the imported trades to existing ones
                            trades = [...trades, ...importedTrades];
                            localStorage.setItem('trades', JSON.stringify(trades));
                            
                            renderTradeLog();
                            calculateStats();
                            
                            alert(`Successfully imported ${importedTrades.length} trades`);
                        } else {
                            alert('Invalid trade data format');
                        }
                    } catch (error) {
                        console.error('Error importing trades:', error);
                        alert('Failed to import trades: Invalid file format');
                    }
                };
                
                reader.readAsText(file);
            }
            
            // Add event listeners
            addTradeBtn.addEventListener('click', addTrade);
            
            exportBtn.addEventListener('click', exportTrades);
            
            importBtn.addEventListener('click', function() {
                importInput.click();
            });
            
            importInput.addEventListener('change', function(e) {
                if (e.target.files.length) {
                    importTrades(e.target.files[0]);
                    // Reset input to allow selecting the same file again
                    e.target.value = '';
                }
            });
            
            // Initialize charts
            let winLossChart = null;
            let pnlHistoryChart = null;
            
            // Create win/loss donut chart
            function createWinLossChart(winCount, lossCount) {
                const ctx = document.getElementById('winLossChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (winLossChart) {
                    winLossChart.destroy();
                }
                
                winLossChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Wins', 'Losses'],
                        datasets: [{
                            data: [winCount, lossCount],
                            backgroundColor: [
                                'rgba(76, 175, 80, 0.8)', // Win color - green
                                'rgba(244, 67, 54, 0.8)'  // Loss color - red
                            ],
                            borderColor: [
                                'rgba(76, 175, 80, 1)',
                                'rgba(244, 67, 54, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e0e0e0',
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const total = winCount + lossCount;
                                        const value = context.raw;
                                        const percentage = Math.round((value / total) * 100);
                                        return `${context.label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Create PnL history chart
            function createPnlHistoryChart() {
                const ctx = document.getElementById('pnlHistoryChart').getContext('2d');
                
                // Sort trades by date
                const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Prepare data - last 20 trades or all if less than 20
                const displayTrades = sortedTrades.slice(-20);
                const labels = displayTrades.map(trade => {
                    const date = new Date(trade.date);
                    return `${date.getMonth() + 1}/${date.getDate()}`;
                });
                
                const pnlData = displayTrades.map(trade => parseFloat(trade.pnl));
                
                // Calculate cumulative PnL
                const cumulativePnl = [];
                let runningTotal = 0;
                pnlData.forEach(pnl => {
                    runningTotal += pnl;
                    cumulativePnl.push(runningTotal);
                });
                
                // Destroy existing chart if it exists
                if (pnlHistoryChart) {
                    pnlHistoryChart.destroy();
                }
                
                pnlHistoryChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                type: 'bar',
                                label: 'Trade P&L',
                                data: pnlData,
                                backgroundColor: pnlData.map(value => value >= 0 ? 'rgba(76, 175, 80, 0.7)' : 'rgba(244, 67, 54, 0.7)'),
                                borderColor: pnlData.map(value => value >= 0 ? 'rgba(76, 175, 80, 1)' : 'rgba(244, 67, 54, 1)'),
                                borderWidth: 1
                            },
                            {
                                type: 'line',
                                label: 'Cumulative P&L',
                                data: cumulativePnl,
                                fill: false,
                                borderColor: 'rgba(33, 150, 243, 1)',
                                tension: 0.1,
                                borderWidth: 2,
                                pointBackgroundColor: 'rgba(33, 150, 243, 1)',
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                ticks: {
                                    color: '#cccccc'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            },
                            y: {
                                ticks: {
                                    color: '#cccccc'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                }
                            },
                            y1: {
                                position: 'right',
                                ticks: {
                                    color: '#33a9ff'
                                },
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e0e0e0',
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.dataset.label || '';
                                        if (label) {
                                            return `${label}: $${context.raw.toFixed(2)}`;
                                        }
                                        return `$${context.raw.toFixed(2)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Update the calculateStats function to also update charts
            const originalCalculateStats = calculateStats;
            calculateStats = function() {
                originalCalculateStats();
                
                // Only create charts if there are trades
                if (trades.length > 0) {
                    const winCount = trades.filter(trade => trade.result === 'Win').length;
                    const lossCount = trades.filter(trade => trade.result === 'Loss').length;
                    
                    // Create charts
                    createWinLossChart(winCount, lossCount);
                    createPnlHistoryChart();
                } else {
                    // Create empty charts as placeholders
                    createWinLossChart(0, 0);
                    createPnlHistoryChart();
                }
            };
            
            // Initialize the app
            initTradeLog();
        });
    </script>
</body>
</html>